

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3.4. lag_calc &mdash; EQcorrscan 0.1.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/EQcorrscan_logo.ico"/>
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="EQcorrscan 0.1.0 documentation" href="../index.html"/>
        <link rel="up" title="3. Core" href="../core.html"/>
        <link rel="next" title="4. Utils" href="../utils.html"/>
        <link rel="prev" title="3.3. match_filter" href="core.match_filter.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../index.html" class="fa fa-home"> EQcorrscan</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">1. Introduction to the EQcorrscan package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../intro.html#why-eqcorrscan">1.1. Why EQcorrscan?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro.html#installation">1.2. Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro.html#functions">1.3. Functions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial.html">2. EQcorrscan tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/template-creation.html">2.1. Template creation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/matched-filter.html">2.2. Matched-filter detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/lag-calc.html">2.3. Lag time calculation and pick correction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/mag-calc.html">2.4. Magnitude calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/clustering.html">2.5. Clustering and stacking</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../core.html">3. Core</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="core.bright_lights.html">3.1. bright_lights</a></li>
<li class="toctree-l2"><a class="reference internal" href="core.template_gen.html">3.2. template_gen</a></li>
<li class="toctree-l2"><a class="reference internal" href="core.match_filter.html">3.3. match_filter</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">3.4. lag_calc</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../utils.html">4. Utils</a><ul>
<li class="toctree-l2"><a class="reference internal" href="utils.Sfile_util.html">4.1. Sfile_util</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.findpeaks.html">4.2. findpeaks</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.clustering.html">4.3. clustering</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.pre_processing.html">4.4. pre_processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.EQcorrscan_plotting.html">4.5. EQcorrscan_plotting</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.mag_calc.html">4.6. mag_calc</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.stacking.html">4.7. stacking</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.catalogue2DD.html">4.8. catalogue2DD</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">EQcorrscan</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../core.html">3. Core</a> &raquo;</li>
      
    <li>3.4. lag_calc</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="../_sources/submodules/core.lag_calc.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="module-lag_calc">
<span id="lag-calc"></span><h1>3.4. lag_calc<a class="headerlink" href="#module-lag_calc" title="Permalink to this headline">¶</a></h1>
<p>Functions to generate lag-times for events detected by correlation.</p>
<p>Part of the EQcorrscan module to integrate seisan nordic files into a full
cross-channel correlation for detection routine.
EQcorrscan is a python module designed to run match filter routines for
seismology, within it are routines for integration to seisan and obspy.
With obspy integration (which is necessary) all main waveform formats can be
read in and output.</p>
<p>This main section contains a script, LFE_search.py which demonstrates the usage
of the built in functions from template generation from picked waveforms
through detection by match filter of continuous data to the generation of lag
times to be used for relative locations.</p>
<p>The match-filter routine described here was used a previous Matlab code for the
Chamberlain et al. 2014 G-cubed publication.  The basis for the lag-time
generation section is outlined in Hardebeck &amp; Shelly 2011, GRL.</p>
<p>Code generated by Calum John Chamberlain of Victoria University of Wellington,
2015.</p>
<p class="rubric">Note</p>
<dl class="docutils">
<dt>Pre-requisites:</dt>
<dd><ul class="first last">
<li><p class="first">gcc             - for the installation of the openCV correlation routine</p>
</li>
<li><p class="first">python-cv2      - Python bindings for the openCV routines</p>
</li>
<li><p class="first">python-joblib   - used for parallel processing</p>
</li>
<li><dl class="first docutils">
<dt>python-obspy    - used for lots of common seismological processing</dt>
<dd><ul class="first last">
<li><dl class="first docutils">
<dt>requires:</dt>
<dd><ul class="first last simple">
<li>numpy</li>
<li>scipy</li>
<li>matplotlib</li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">NonLinLoc       - used outside of all codes for travel-time generation</p>
</li>
</ul>
</dd>
</dl>
<p>Copyright 2015 Calum Chamberlain</p>
<p>This file is part of EQcorrscan.</p>
<blockquote>
<div><p>EQcorrscan is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.</p>
<p>EQcorrscan is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.</p>
<p>You should have received a copy of the GNU General Public License
along with EQcorrscan.  If not, see &lt;<a class="reference external" href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>&gt;.</p>
</div></blockquote>
<dl class="function">
<dt id="lag_calc._channel_loop">
<code class="descclassname">lag_calc.</code><code class="descname">_channel_loop</code><span class="sig-paren">(</span><em>detection</em>, <em>template</em>, <em>i=0</em><span class="sig-paren">)</span><a class="headerlink" href="#lag_calc._channel_loop" title="Permalink to this definition">¶</a></dt>
<dd><p>Utility function to take a stream of data for the detected event and parse
the correct data to lag_gen</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>detection</strong> (<em>obspy.Stream</em>) &#8211; Stream of data for the slave event detected using     template</li>
<li><strong>template</strong> (<em>obspy.Stream</em>) &#8211; Stream of data as the template for the detection.</li>
<li><strong>i</strong> (<em>int, optional</em>) &#8211; Used to track which process has occured when running in parallel</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">picks, a tuple of (lag in s, cross-correlation value, station,     chan)</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="lag_calc.day_loop">
<code class="descclassname">lag_calc.</code><code class="descname">day_loop</code><span class="sig-paren">(</span><em>detection_streams</em>, <em>template</em><span class="sig-paren">)</span><a class="headerlink" href="#lag_calc.day_loop" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to loop through multiple detections for one template - ostensibly
designed to run for the same day of data for I/O simplicity, but as you
are passing stream objects it could run for all the detections ever, as long
as you have the RAM!</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>detection_streams</strong> (<em>List of obspy.Stream</em>) &#8211; List of all the detections for this template that you
want to compute the optimum pick for.</li>
<li><strong>template</strong> (<em>obspy.Stream</em>) &#8211; The original template used to detect the detections passed</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">lags - List of List of tuple: lags[i] corresponds to detection[i],
lags[i][j] corresponds to a channel of detection[i], within
this tuple is the lag (in seconds), normalised correlation,
station and channel.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="lag_calc.lag_calc">
<code class="descclassname">lag_calc.</code><code class="descname">lag_calc</code><span class="sig-paren">(</span><em>detections</em>, <em>detect_data</em>, <em>templates</em>, <em>shift_len=0.2</em>, <em>min_cc=0.4</em><span class="sig-paren">)</span><a class="headerlink" href="#lag_calc.lag_calc" title="Permalink to this definition">¶</a></dt>
<dd><p>Overseer function to take a list of detection objects, cut the data for
them to lengths of the same length of the template + shift_len on
either side. This will then write out SEISAN s-file for the detections
with pick times based on the lag-times found at the maximum correlation,
providing that correlation is above the min_cc.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>detections</strong> (<em>List of DETECTION</em>) &#8211; List of DETECTION objects</li>
<li><strong>detect_data</strong> (<em>obspy.Stream</em>) &#8211; All the data needed to cut from - can be a gappy Stream</li>
<li><strong>templates</strong> (<em>List of tuple of String, obspy.Stream</em>) &#8211; List of the templates used as tuples of template name, template</li>
<li><strong>shift_len</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#float" title="(in Python v2.7)"><em>float</em></a>) &#8211; Shift length allowed for the pick in seconds, will be
plus/minus this amount - default=0.2</li>
<li><strong>min_cc</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#float" title="(in Python v2.7)"><em>float</em></a>) &#8211; Minimum cross-correlation value to be considered a pick,
default=0.4</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../utils.html" class="btn btn-neutral float-right" title="4. Utils">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="core.match_filter.html" class="btn btn-neutral" title="3.3. match_filter"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, 2016: Calum John Chamberlain &amp; Chet Hopp.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>