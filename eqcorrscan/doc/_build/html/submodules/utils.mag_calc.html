

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>5.5. mag_calc &mdash; EQcorrscan 0.1.2rc documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/EQcorrscan_logo.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="EQcorrscan 0.1.2rc documentation" href="../index.html"/>
        <link rel="up" title="5. Utils" href="../utils.html"/>
        <link rel="next" title="5.6. pre_processing" href="utils.pre_processing.html"/>
        <link rel="prev" title="5.4. locate" href="utils.locate.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> EQcorrscan
          

          
            
            <img src="../_static/EQcorrscan_logo.jpg" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">1. Introduction to the EQcorrscan package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../updates.html">2. What&#8217;s new</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial.html">3. EQcorrscan tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core.html">4. Core</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../utils.html">5. Utils</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="utils.clustering.html">5.1. clustering</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.plotting.html">5.2. plotting</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.findpeaks.html">5.3. findpeaks</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.locate.html">5.4. locate</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">5.5. mag_calc</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.pre_processing.html">5.6. pre_processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.seismo_logs.html">5.7. seismo_logs</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.sfile_util.html">5.8. sfile_util</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.stacking.html">5.9. stacking</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.synth_seis.html">5.10. synth_seis</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.catalog_to_dd.html">5.11. catalog_to_dd</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.sac_util.html">5.12. sac_util</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">EQcorrscan</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../utils.html">5. Utils</a> &raquo;</li>
      
    <li>5.5. mag_calc</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/submodules/utils.mag_calc.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-mag_calc">
<span id="mag-calc"></span><h1>5.5. mag_calc<a class="headerlink" href="#module-mag_calc" title="Permalink to this headline">¶</a></h1>
<p>Functions to calculate local magnitudes automatically, and to calcualte relative moments for near-repeating earthquakes using singular-value decomposition techniques.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">copyright:</th><td class="field-body">Calum Chamberlain, Chet Hopp.</td>
</tr>
<tr class="field-even field"><th class="field-name">license:</th><td class="field-body">GNU Lesser General Public License, Version 3
(<a class="reference external" href="https://www.gnu.org/copyleft/lesser.html">https://www.gnu.org/copyleft/lesser.html</a>)</td>
</tr>
</tbody>
</table>
<dl class="function">
<dt id="mag_calc.Amp_pick_sfile">
<code class="descclassname">mag_calc.</code><code class="descname">Amp_pick_sfile</code><span class="sig-paren">(</span><em>sfile, datapath, respdir, chans=[u'Z'], var_wintype=True, winlen=0.9, pre_pick=0.2, pre_filt=True, lowcut=1.0, highcut=20.0, corners=4</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mag_calc.html#Amp_pick_sfile"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mag_calc.Amp_pick_sfile" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to read information from a SEISAN s-file, load the data and the     picks, cut the data for the channels given around the S-window, simulate     a Wood Anderson seismometer, then pick the maximum peak-to-trough     amplitude.</p>
<p>Output will be put into a mag_calc.out file which will be in full S-file     format and can be copied to a REA database.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>datapath</strong> (<em>string</em>) &#8211; Path to the waveform files - usually the path to the WAV         directory</li>
<li><strong>respdir</strong> (<em>string</em>) &#8211; Path to the response information directory</li>
<li><strong>chans</strong> (<em>List of strings</em>) &#8211; List of the channels to pick on, defaults to [&#8216;Z&#8217;] - should         just be the orientations, e.g. Z,1,2,N,E</li>
<li><strong>var_wintype</strong> (<em>bool</em>) &#8211; If True, the winlen will be         multiplied by the P-S time if both P and S picks are         available, otherwise it will be multiplied by the         hypocentral distance*0.34 - dervided using a p-s ratio of         1.68 and S-velocity of 1.5km/s to give a large window,         defaults to True</li>
<li><strong>winlen</strong> (<em>float</em>) &#8211; Length of window, see above parameter, if var_wintype is         False then this will be in seconds, otherwise it is the         multiplier to the p-s time, defaults to 0.5.</li>
<li><strong>pre_pick</strong> (<em>float</em>) &#8211; Time before the s-pick to start the cut window, defaults         to 0.2</li>
<li><strong>pre_filt</strong> (<em>bool</em>) &#8211; To apply a pre-filter or not, defaults to True</li>
<li><strong>lowcut</strong> (<em>float</em>) &#8211; Lowcut in Hz for the pre-filter, defaults to 1.0</li>
<li><strong>highcut</strong> (<em>float</em>) &#8211; Highcut in Hz for the pre-filter, defaults to 20.0</li>
<li><strong>corners</strong> (<em>int</em>) &#8211; Number of corners to use in the pre-filter</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="mag_calc.SVD_moments">
<code class="descclassname">mag_calc.</code><code class="descname">SVD_moments</code><span class="sig-paren">(</span><em>U</em>, <em>s</em>, <em>V</em>, <em>stachans</em>, <em>event_list</em>, <em>n_SVs=4</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mag_calc.html#SVD_moments"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mag_calc.SVD_moments" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to convert basis vectors calculated by singular value     decomposition (see the SVD functions in clustering) into relative     magnitudes.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>U</strong> (<em>List of np.ndarray</em>) &#8211; List of the input basis vectors from the SVD, one array for         each channel used.</li>
<li><strong>s</strong> (<em>List of nd.array</em>) &#8211; List of the singular values, one array for each channel</li>
<li><strong>V</strong> (<em>List of np.ndarry</em>) &#8211; List of output basis vectors from SVD, one array per channel.</li>
<li><strong>stachans</strong> (<em>List of string</em>) &#8211; List of station.channel input</li>
<li><strong>event_list</strong> (<em>List of list</em>) &#8211; List of events for which you have data, such that         event_list[i] corresponds to stachans[i], U[i] etc. and         event_list[i][j] corresponds to event j in U[i]</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>type n_SVs: int
:param n_SVs: Number of singular values to use, defaults to 4.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">M, np.array of relative moments</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="mag_calc._GSE2_PAZ_read">
<code class="descclassname">mag_calc.</code><code class="descname">_GSE2_PAZ_read</code><span class="sig-paren">(</span><em>GSEfile</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mag_calc.html#_GSE2_PAZ_read"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mag_calc._GSE2_PAZ_read" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to read the instrument response information from a GSE Poles and     Zeros file as generated by the SEISAN program RESP.</p>
<p>Format must be CAL2, not coded for any other format at the moment,     contact the authors to add others in.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>GSEfile</strong> (<em>string</em>) &#8211; Path to GSE file</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Dict of poles, zeros, gain and sensitivity</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="mag_calc._find_resp">
<code class="descclassname">mag_calc.</code><code class="descname">_find_resp</code><span class="sig-paren">(</span><em>station</em>, <em>channel</em>, <em>network</em>, <em>time</em>, <em>delta</em>, <em>directory</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mag_calc.html#_find_resp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mag_calc._find_resp" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper function to find the response information for a given station and     channel at a given time and return a dictionary of poles and zeros, gain     and sensitivity.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>station</strong> (<em>str</em>) &#8211; Station name (as in the response files)</li>
<li><strong>channel</strong> (<em>str</em>) &#8211; Channel name (as in the response files)</li>
<li><strong>network</strong> (<em>str</em>) &#8211; Network to scan for, can be a wildcard</li>
<li><strong>time</strong> (<em>datetime.datetime</em>) &#8211; Date-time to look for repsonse information</li>
<li><strong>delta</strong> (<em>float</em>) &#8211; Sample interval in seconds</li>
<li><strong>directory</strong> (<em>str</em>) &#8211; Directory to scan for response information</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">dict, response information</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="mag_calc._max_p2t">
<code class="descclassname">mag_calc.</code><code class="descname">_max_p2t</code><span class="sig-paren">(</span><em>data</em>, <em>delta</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mag_calc.html#_max_p2t"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mag_calc._max_p2t" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to find the maximum peak-to-trough amplitude and period of this     amplitude.  Originally designed to be used to calculate magnitudes (by     taking half of the peak-to-trough amplitude as the peak amplitude).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>data</strong> (<em>ndarray</em>) &#8211; waveform trace to find the peak-to-trough in.</li>
<li><strong>delta</strong> (<em>float</em>) &#8211; Sampling interval in seconds</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">tuple of (amplitude, period, time) with amplitude in the same         scale as given in the input data, and period in seconds, and time in         seconds from the start of the data window.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="mag_calc._pairwise">
<code class="descclassname">mag_calc.</code><code class="descname">_pairwise</code><span class="sig-paren">(</span><em>iterable</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mag_calc.html#_pairwise"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mag_calc._pairwise" title="Permalink to this definition">¶</a></dt>
<dd><p>Wrapper on itertools for SVD_magnitude.</p>
</dd></dl>

<dl class="function">
<dt id="mag_calc._sim_WA">
<code class="descclassname">mag_calc.</code><code class="descname">_sim_WA</code><span class="sig-paren">(</span><em>trace</em>, <em>PAZ</em>, <em>seedresp</em>, <em>water_level</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mag_calc.html#_sim_WA"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mag_calc._sim_WA" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to remove the insturment response from a trace and return a     de-meaned, de-trended, Wood Anderson simulated trace in it&#8217;s place.</p>
<p>Works in-place on data and will destroy your original data, copy the     trace before giving it to this function!</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>trace</strong> (<em>obspy.Trace</em>) &#8211; A standard obspy trace, generally should be given without
pre-filtering, if given with pre-filtering for use with
amplitude determiniation for magnitudes you will need to
worry about how you cope with the response of this filter
yourself.</li>
<li><strong>PAZ</strong> (<em>dict</em>) &#8211; Dictionary containing lists of poles and zeros, the gain and
the sensitivity.</li>
<li><strong>water_level</strong> (<em>int</em>) &#8211; Water level for the simulation.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">obspy.Trace</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="mag_calc.dist_calc">
<code class="descclassname">mag_calc.</code><code class="descname">dist_calc</code><span class="sig-paren">(</span><em>loc1</em>, <em>loc2</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mag_calc.html#dist_calc"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mag_calc.dist_calc" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to calcualte the distance in km between two points, uses the     flat Earth approximation.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>loc1</strong> (<em>tuple</em>) &#8211; Tuple of lat, lon, depth (in decimal degrees and km)</li>
<li><strong>loc2</strong> (<em>tuple</em>) &#8211; Tuple of lat, lon, depth (in decimal degrees and km)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">float, Distance between points.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="mag_calc.pick_db">
<code class="descclassname">mag_calc.</code><code class="descname">pick_db</code><span class="sig-paren">(</span><em>indir</em>, <em>outdir</em>, <em>calpath</em>, <em>startdate</em>, <em>enddate</em>, <em>wavepath=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mag_calc.html#pick_db"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mag_calc.pick_db" title="Permalink to this definition">¶</a></dt>
<dd><p>Wrapper to loop through a SEISAN database and make a lot of magnitude     picks.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>indir</strong> (<em>str</em>) &#8211; Path to the seisan REA directory (not including yyyy/mm)</li>
<li><strong>outdir</strong> (<em>str</em>) &#8211; Path to output seisan REA directory (not including yyyy/mm)</li>
<li><strong>calpath</strong> (<em>str</em>) &#8211; Path to the directory containing the response files</li>
<li><strong>startdate</strong> (<em>datetime.datetime</em>) &#8211; Date to start looking for S-files</li>
<li><strong>enddate</strong> (<em>datetime.datetime</em>) &#8211; Date to stop looking for S-files</li>
<li><strong>wavepath</strong> (<em>str</em>) &#8211; Path to the seisan WAV directory (not including yyyy/mm)</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="utils.pre_processing.html" class="btn btn-neutral float-right" title="5.6. pre_processing" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="utils.locate.html" class="btn btn-neutral" title="5.4. locate" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, 2016: Calum John Chamberlain &amp; Chet Hopp.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.1.2rc',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>